const mongoose = require('mongoose');
require('mongoose-type-email');
const { Schema } = mongoose;

const categories = {
  type: { category: String, rating: Number },
  enum: ['ACCURACY_OF_POST', 'QUALITY_OF_WORK', 'PUNCTULAITY', 'MANNERS', 'COMMUNICATION'],
};
const ReviewSchema = new Schema(
  {
    jobId: { type: Schema.Types.ObjectId, ref: 'JobModel' },
    bidderId: { type: Schema.Types.ObjectId, ref: 'UserModel' },
    proposerId: { type: Schema.Types.ObjectId, ref: 'UserModel' },
    proposerReview: {
      type: {
        ratingCategories: { type: categories, RatingSchema: false },
        jobRating: Number,
        comment: String, //max 120 chars
      },
    },
    state: {
      type: String,
      enum: ['AWAITING', 'REVEALED'],
    },

    bidderReview: {
      type: {
        ratingCategories: { type: categories, RatingSchema: false },
        jobRating: Number,
        comment: String, //max 120 chars
      },
    },
    proposerSubmitted: { type: Boolean, default: false },
    bidderSubmitted: { type: Boolean, default: false },
    reveal: { type: Boolean, default: false }, //this wil turn true only when both completed the review
    extras: { type: Object },
  },
  { timestamps: true } // createdAt and updatedAt auto generated by mongoose
);

//no need for index on these . avoid performance slowness
mongoose.model('ReviewModel', ReviewSchema);
