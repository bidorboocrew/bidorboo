const mongoose = require('mongoose');
require('mongoose-type-email');
const { Schema } = mongoose;

const RatingSchema = new Schema({
  categoryOfRating: {
    type: String,
    enum: [
      'ACCURACY_OF_POST',
      'PROFICIENCY',
      'ON_TIME',
      'MANNERS',
      'CLEANLINESS'
    ]
  },
  rating: Number
});
const ReviewSchema = new Schema(
  {
    _jobId: { type: Schema.Types.ObjectId, ref: 'JobModel' },
    _bidderId: { type: Schema.Types.ObjectId, ref: 'UserModel' },
    _proposerId: { type: Schema.Types.ObjectId, ref: 'UserModel' },
    proposerReview: {
      type: {
        rating: [RatingSchema],
        comment: String, //max 120 chars
        completed: { type: Boolean, default: false }
      },
      default: null
    },
    bidderReview: {
      type: {
        rating: Number,
        comment: [RatingSchema], //max 120 chars
        completed: { type: Boolean, default: false }
      },
      default: null
    },
    shouldRevealResultsToBoth: { type: Boolean, default: false }, //this wil turn true only when both completed the review
    extras: { type: Object, default: null }
  },
  { timestamps: true } // createdAt and updatedAt auto generated by mongoose
);

mongoose.model('ReviewModel', ReviewSchema);
